---
title: "NAT与内网穿透"
date: 2024-03-19T16:10:50+08:00
---

# NAT与内网穿透
## 写在前面
`NAT（network adress transform）`：中文名：网络地址转换技术，是为了解决由于日渐增长的网络设备数量，IPV4地址池逐渐枯竭问题而诞生，路由设备通过NAT地址转换来节省IPV4地址，同时根据不同的映射方式有些不同的NAT映射类型，同时也为某些网络通信带来了一定的困难。

`P2P（Peer To Peer）`：点对点通信协议，现运营商已基本封堵，封堵原因除了传播违法，不遵守专利信息以外，主要是对运营商带宽的吞噬，因为P2P中每个设备既是客户端又是服务端，一个客户端可以利用其他客户端上的内容进行加速，不需要中心服务器进行调度，这样少了服务器的带宽费用。
## 全锥形NAT
最简单的NAT类型，路由设备通过IP+端口的方式唯一确定一个子网设备，子网设备与广域网设备的交互就通过路由维护的表进行数据转发，公网设备在防火墙顺利通过情况下可以直接访问子网设备
### 受限型NAT
全锥形的子类型，添加了限制条件，当内网主机已经访问过一次广域网主机后，公网主机能发送数据给子网设备
### 端口限制型NAT
全锥形的子类型，在受限型NAT添加了更严格的限制条件，子网设备访问目标设备的确定端口进行交流，在受限型NAT下，只要IP地址没变，端口不同也能互相通信，但是端口受限型指定必须是上一次交流的端口，不然开启新映射。

## 对称性NAT
最严格的NAT类型，P2P通信被严格限制，而且顾名思义公网设备与子网设备对称，对称性NAT通过四元组确定一个映射$M=SA,SP,TA,TP$，SA为源地址，SP为源端口，TA为目标地址，TP为目标端口，四元组一个中一个不同就是一个新映射。

## 对称性NAT与端口限制型区别？
锥形和对称性顾名思义，锥形NAT下，考虑的都是目标地址和端口，内网设备IP和端口不在考虑中，而对称性NAT下，内网设备IP和端口也是影响映射的因素。